<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plinko (Play‑Money)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1420;--panel:#0f1926;--card:#111827;--text:#e5e7eb;--muted:#9aa4b2;--green:#22c55e}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:#0b1420;}
    .wrap{height:100%;display:grid;grid-template-columns:320px 1fr;gap:12px;padding:12px}
    .panel{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:12px}
    .title{font-size:14px;color:var(--muted);margin:0 0 4px}
    label{font-size:12px;color:#c7d2fe;margin:8px 0 4px;display:block}
    input,select{width:100%;background:#0c1522;border:1px solid rgba(255,255,255,.08);color:var(--text);padding:10px;border-radius:8px;outline:none}
    .btn{background:var(--green);color:#041014;font-weight:800;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.ghost{background:#101b2b;color:var(--text);border:1px solid rgba(255,255,255,.10)}
    .row{display:flex;gap:8px;align-items:center}
    .balance{display:flex;justify-content:space-between;align-items:baseline;background:#0c1522;border:1px solid rgba(255,255,255,.06);padding:10px;border-radius:10px}
    .big{font-size:20px;font-weight:800}

    .stage{background:#0f1826;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px;position:relative;overflow:hidden}
    #world{width:100%;height:100%;background:#0f1826;border-radius:8px}
    #slotTiles{position:absolute;left:10px;right:10px;bottom:10px;height:40px;display:flex;gap:6px;align-items:flex-end;pointer-events:none}
    .tile{height:28px;border-radius:6px;border:1px solid rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#0b1420}

    .payouts{display:flex;gap:6px;flex-wrap:wrap}
    .chip{background:#111827;border:1px solid rgba(255,255,255,.08);padding:6px 8px;border-radius:8px;font-weight:700}

    @media (max-width:980px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="panel">
      <div class="title">Controls</div>
      <div class="balance"><div>Balance</div><div id="balance" class="big">10,000.00</div></div>

      <label>Amount</label>
      <div class="row"><input id="bet" type="number" step="0.01" value="1.00"><button id="max" class="btn ghost">MAX</button></div>

      <label>Risk</label>
      <select id="risk"><option value="low">Low</option><option value="medium" selected>Medium</option><option value="high">High</option></select>

      <label>Rows</label>
      <select id="rowsSel"></select>

      <label>Balls per click</label>
      <select id="count"><option>1</option><option>5</option><option selected>10</option><option>25</option><option>50</option></select>

      <div class="row"><button id="drop" class="btn">Play</button><button id="auto" class="btn ghost">Auto (off)</button><button id="reset" class="btn ghost">Reset</button></div>

      <label>Client seed (visual only)</label>
      <input id="seed" value="my-seed-0001"/>

      <label>Current payout table</label>
      <div id="payouts" class="payouts"></div>

      <div style="font-size:11px;color:var(--muted)">Play‑money demo. No deposits/withdrawals. Visuals only.</div>
    </aside>

    <main class="stage">
      <canvas id="world"></canvas>
      <div id="slotTiles"></div>
    </main>
  </div>

  <script src="https://unpkg.com/matter-js@0.20.0/build/matter.min.js"></script>
  <script>
    // ----- Utilities -----
    const fmt = n => Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
    function strHash(s){let h=1779033703^s.length;for(let i=0;i<s.length;i++){h=Math.imul(h^s.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return(h>>>0);}

    function buildPayouts(rows,risk){
      const slots = rows+1; const center=(slots-1)/2; const out=[];
      for(let i=0;i<slots;i++){
        const d=Math.abs(i-center)/center; let m;
        if(risk==='low') m=0.4 + (1.2-0.4)*(1-Math.pow(d,1.8));
        else if(risk==='high') m=0.1 + (15-0.1)*Math.pow(d,2.2);
        else m=0.2 + (5.5-0.2)*Math.pow(d,1.8);
        out.push(Number(m.toFixed(2)));
      }
      const avg = out.reduce((a,b)=>a+b,0)/out.length; const scale=0.96/avg; return out.map(v=>Number((v*scale).toFixed(2)));
    }

    function colorForSlot(i,slots){
      const center=(slots-1)/2; const d=Math.abs(i-center)/center; return d>0.75?'#ef4444': d>0.45?'#f59e0b':'#facc15';
    }

    // ----- DOM -----
    const el=id=>document.getElementById(id);
    const balanceEl=el('balance'); const betEl=el('bet'); const riskEl=el('risk'); const countEl=el('count');
    const dropBtn=el('drop'); const autoBtn=el('auto'); const resetBtn=el('reset'); const maxBtn=el('max');
    const payoutsEl=el('payouts'); const seedEl=el('seed'); const rowsSel=el('rowsSel');

    ;[8,9,10,12,14,16].forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v; if(v===16) o.selected=true; rowsSel.appendChild(o);});

    let balance=10000, auto=false;
    let engine, render, world; let balls=[];

    function updateBalance(){balanceEl.textContent=fmt(balance)}

    function drawTiles(payouts){
      const rows=Number(rowsSel.value); const slots=rows+1; const tiles=el('slotTiles'); tiles.innerHTML='';
      const canvas=el('world'); const width=canvas.width; const spacingX=Math.min(44,(width-120)/slots);
      const offsetX=(width - spacingX*(slots-1))/2;
      for(let i=0;i<slots;i++){
        const tile=document.createElement('div'); tile.className='tile'; tile.style.flex=`0 0 ${spacingX-4}px`;
        tile.style.background=colorForSlot(i,slots); tile.textContent=(Math.round(payouts[i]*10)/10).toFixed(1).replace(/\.0$/,'')+'x';
        tiles.appendChild(tile);
      }
    }

    function renderPayouts(){
      const rows=Number(rowsSel.value); const payouts=buildPayouts(rows, riskEl.value); payoutsEl.innerHTML='';
      payouts.forEach(m=>{const d=document.createElement('div'); d.className='chip'; d.textContent=(Math.round(m*10)/10).toFixed(1).replace(/\.0$/,'')+'x'; payoutsEl.appendChild(d);});
      drawTiles(payouts); return payouts;
    }

    // ----- Physics world -----
    const { Engine, Render, Runner, World, Bodies, Body } = Matter;

    function fitCanvas(){const c=el('world'); const p=c.parentElement; c.width=p.clientWidth-20; c.height=Math.max(520,p.clientHeight-20); if(render){render.canvas=c; render.options.width=c.width; render.options.height=c.height;}}

    function makePeg(x,y){return Bodies.circle(x,y,4.5,{isStatic:true, render:{fillStyle:'#ffffff'}})}

    function rebuildBoard(){
      if(engine){World.clear(engine.world,true); Engine.clear(engine);} engine=Engine.create(); world=engine.world;
      const c=el('world'); const width=c.width; const height=c.height; const rows=Number(rowsSel.value);
      const cols=rows+1; const spacingX=Math.min(44,(width-120)/cols); const spacingY=Math.min(32,(height-200)/(rows+3));
      const offsetX=(width - spacingX*(cols-1))/2; const offsetY=60;
      const pegs=[]; for(let r=0;r<rows;r++){ for(let cc=0;cc<=r;cc++){ const x=offsetX + (cols-r-1)*spacingX/2 + cc*spacingX; const y=offsetY + r*spacingY; pegs.push(makePeg(x,y)); }}
      World.add(world, pegs);
      const ground=Bodies.rectangle(width/2,height-10,width,40,{isStatic:true,render:{fillStyle:'#0f1826'}}); World.add(world,[ground]);
      if(render) Render.stop(render); render=Render.create({canvas:el('world'), engine, options:{width:el('world').width,height:el('world').height, wireframes:false, background:'transparent', pixelRatio:window.devicePixelRatio||1}}); Render.run(render);
      Runner.run(Engine.create(), engine);
      drawTiles(buildPayouts(rows, riskEl.value));
    }

    function currentRng(){return mulberry32(strHash(seedEl.value)>>>0)}

    function dropBalls(n){
      const c=el('world'); const width=c.width; const rows=Number(rowsSel.value); const slots=rows+1; const spacingX=Math.min(44,(width-120)/slots); const offsetX=(width - spacingX*(slots-1))/2; const rng=currentRng();
      const payouts=buildPayouts(rows, riskEl.value); const bet=Math.max(0,Number(betEl.value)||0); if(bet<=0) return;
      for(let i=0;i<n;i++){
        const x=offsetX + (slots-1)/2*spacingX + (rng()-0.5)*spacingX*0.4;
        const ball=Bodies.circle(x,40,6.5,{restitution:0.35,friction:0.02,frictionAir:0.001, render:{fillStyle:'#ffffff',strokeStyle:'#0a0f14',lineWidth:1}});
        ball._bet=bet; ball._payouts=payouts; ball._settled=false; ball._rows=rows; World.add(world,ball); Body.setVelocity(ball,{x:(rng()-0.5)*2.2,y:0}); balls.push(ball);
      }
    }

    function settleCheck(){
      const c=el('world'); const width=c.width; const rows=Number(rowsSel.value); const slots=rows+1; const spacingX=Math.min(44,(width-120)/slots); const offsetX=(width - spacingX*(slots-1))/2; const baseY=60 + rows*Math.min(32,(c.height-200)/(rows+3)) + 20;
      balls.forEach(b=>{ if(b._settled) return; if(b.position.y>baseY+60 && Math.abs(b.velocity.y)<0.3){ let slot=Math.round((b.position.x - offsetX)/spacingX); slot=Math.max(0,Math.min(slots-1,slot)); const mul=b._payouts[slot]; const profit=b._bet*(mul-1); balance+=profit; updateBalance(); b._settled=true; }});
      balls=balls.filter(b=>b.position.y<c.height+100); requestAnimationFrame(settleCheck);
    }

    // ----- Wire up -----
    window.addEventListener('resize',()=>{fitCanvas(); rebuildBoard();});
    dropBtn.addEventListener('click',()=>{const n=Number(countEl.value); const total=(Number(betEl.value)||0)*n; if(total>0) balance-=total; updateBalance(); dropBalls(n);});
    autoBtn.addEventListener('click',()=>{auto=!auto; autoBtn.textContent=`Auto (${auto?'on':'off'})`});
    setInterval(()=>{if(auto) dropBtn.click();},650);
    resetBtn.addEventListener('click',()=>{balance=10000; updateBalance(); rebuildBoard();});
    maxBtn.addEventListener('click',()=>{betEl.value=Math.max(1,balance/10).toFixed(2)});
    [rowsSel,riskEl].forEach(c=>c.addEventListener('input',()=>renderPayouts() && rebuildBoard()));

    (function init(){fitCanvas(); updateBalance(); renderPayouts(); rebuildBoard(); settleCheck();})();
  </script>
</body>
</html>
